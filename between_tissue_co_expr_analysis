# Load libraries
```{r}
.libPaths("/usr/lib/R/site-library")
library("edgeR", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("DESeq2", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("DEsingle", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("biomaRt",quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("goseq" ,quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("VennDiagram", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("ggpubr", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("Rtsne", quietly = TRUE,lib.loc="/usr/lib/R/site-library")
library("MEGENA",quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("DGCA", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library('dplyr', quietly = TRUE,lib.loc="/usr/lib/R/site-library")
library("ggplot2", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("ggrepel", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("gridExtra",quietly = TRUE , lib.loc="/usr/lib/R/site-library")
library("readr" , quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("ggfortify" , quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("cowplot" , quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("tidyverse", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("WGCNA", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("reshape2", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("foreach", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("doParallel", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("bigmemory", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("gtools", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("data.table", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("flashClust", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("dendextend", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library('vegan', quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("ade4", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("gridGraphics", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library("networkD3", quietly = TRUE, lib.loc="/usr/lib/R/site-library")
library(readxl, quietly = TRUE, lib.loc="/usr/lib/R/site-library")
```

# Load the annotation 
```{r}
cow<-useMart("ensembl", 
             dataset = "btaurus_gene_ensembl",
             host="www.ensembl.org") 

annotation.ensembl.symbol<-getBM(attributes = c('ensembl_gene_id',
                                                'external_gene_name',
                                                'description','hgnc_symbol',
                                                'gene_biotype',
                                                'transcript_length',
                                                'chromosome_name',
                                                'start_position',
                                                'end_position','strand'), 
                                 values = "*",
                                 mart = cow)
annotation.ensembl.transcript<-getBM(attributes = c('ensembl_gene_id',
                                                    'gene_biotype',
                                                    'ensembl_transcript_id',
                                                    'transcript_length'), 
                                     values = "*", 
                                     mart = cow)

annotation.ensembl.transcript<-annotation.ensembl.transcript[annotation.ensembl.transcript$gene_biotype =="protein_coding",]

# Sorts gene ID in descending order by transcript length.
annotation.ensembl.transcript<-annotation.ensembl.transcript[order(annotation.ensembl.transcript$ensembl_gene_id, -annotation.ensembl.transcript$transcript_length),]


# Removes any duplicate gene IDs
annotation.ensembl.transcript<-annotation.ensembl.transcript[!duplicated(annotation.ensembl.transcript$ensembl_gene_id),]

# Include transcripts that are at least 400 base pairs long.
annotation.ensembl.transcript<-annotation.ensembl.transcript[annotation.ensembl.transcript$transcript_length > 400,]

annotation.ensembl.symbol<-annotation.ensembl.symbol[order(annotation.ensembl.symbol$ensembl_gene_id, -annotation.ensembl.symbol$transcript_length),]

annotation.ensembl.symbol<-annotation.ensembl.symbol[!duplicated(annotation.ensembl.symbol$ensembl_gene_id),]

gene.length<-annotation.ensembl.symbol[,c( "ensembl_gene_id", "transcript_length" )]

annotation.GO.biomart<-getBM(attributes = c('ensembl_gene_id',
                                            'external_gene_name',
                                            'go_id',
                                            'name_1006',
                                            'namespace_1003'),
                             values = "*",
                             mart = cow)
```

# Keep only the  reads belonging to the 'protein_coding', 'lncRNA' gene classes 
```{r}
annotation.ensembl.symbol<-annotation.ensembl.symbol[annotation.ensembl.symbol$gene_biotype %in% c('protein_coding', 'lncRNA'),]
```

```{r}
write.table(annotation.ensembl.symbol,
            file = "/home/yassine/Downloads/between_tissue/annotation.ensembl.symbol.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)

write.table(gene.length,
            file = "/home/yassine/Downloads/between_tissue/gene.length.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE) 

write.table(annotation.GO.biomart,
            file = "/home/yassine/Downloads/between_tissue/annotation.GO.biomart.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE) 
```


# Load count data information (meta data) 

```{r}
sample_info <- as.data.frame(read_excel("/home/yassine/Downloads/Repro_omics_sample_information_06_27_2023.xlsx"))

```

```{r}
data_info <- sample_info[, -4] %>% # Remove the fourth column
  filter(!is.na(sample_info[[5]])) %>% #Keep rows with non-NA entries in the fifth column (tissu)
  dplyr::rename(tissu = sample)%>% # Rename the 'sample' column to 'tissu'
  filter(!is.na(heiferID))%>% #Remove rows with NA entry in the 'heiferID' column
  mutate(month = as.integer(gsub("-month", "", month)))#Convert character entries in the 'month' column to integers

colnames(data_info)[4] <- "sample"
data_info$sample_name <- paste0(data_info$heiferID, "_", data_info$tissu,"_", data_info$month) #To avoid having duplicate samples later 
```

```{r}
data_info$sample<- as.factor(data_info$sample)
data_info$month<- as.factor(data_info$month)
data_info$tissu<- as.factor(data_info$tissu)
data_info$heiferID<- as.factor(data_info$heiferID)
```

```{r}

write.table(data_info,
            file = "/home/yassine/Downloads/between_tissue/data_info.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
```


# Load and create tissue specifc read count data 

```{r}

files<-list.files("/mnt/storage/lab_folder/repro_omics/counting/", 
                  recursive=T,
                  pattern="count", 
                  full.names = TRUE)

files<-files[grep("summary", files, invert = TRUE)]
files<-files[grep(".count1", files, invert = TRUE)]
files<-files[grep(".count2", files, invert = TRUE)]
files<-files[grep(".sh", files, invert = TRUE)]

count_data<-data.frame(matrix(nrow=27607))
for (n in 1:132) {
  count<-read.delim(files[n],
                    header=TRUE, 
                    sep= "\t", 
                    stringsAsFactors = FALSE,
                    comment.char= "#")
  
  count<-count[,c(1,7)]
  count_data<-cbind(count_data,count)
}
rownames(count_data)<-count_data[,2]
count_data<-count_data[,seq(from = 3, 
                            to = 265,
                            by = 2)]
colnames(count_data)<- substr(colnames(count_data),57, 59)
```

```{r}
colnames(count_data)<-data_info$sample_name
```


```{r}
pwbc_columns_6 <- grep("pwbc_6", colnames(count_data))
pwbc_6_read_counts <- count_data[, pwbc_columns_6]

pwbc_columns_9 <- grep("pwbc_9", colnames(count_data))
pwbc_9_read_counts <- count_data[, pwbc_columns_9]

pwbc_columns_19 <- grep("pwbc_19", colnames(count_data))
pwbc_19_read_counts <- count_data[, pwbc_columns_19]

endometrium_columns_6 <- grep("endometrium_6", colnames(count_data))
endometrium_6_read_counts <- count_data[, endometrium_columns_6]

endometrium_columns_9 <- grep("endometrium_9", colnames(count_data))
endometrium_9_read_counts <- count_data[, endometrium_columns_9]

endometrium_columns_19 <- grep("endometrium_19", colnames(count_data))
endometrium_19_read_counts <- count_data[, endometrium_columns_19]

hypothalamus_columns_6 <- grep("hypothalamus_6", colnames(count_data))
hypothalamus_6_read_counts <- count_data[, hypothalamus_columns_6]

hypothalamus_columns_9 <- grep("hypothalamus_9", colnames(count_data))
hypothalamus_9_read_counts <- count_data[, hypothalamus_columns_9]

hypothalamus_columns_19 <- grep("hypothalamus_19", colnames(count_data))
hypothalamus_19_read_counts <- count_data[, hypothalamus_columns_19]

pituitary_columns_6 <- grep("pituitary_6", colnames(count_data))
pituitary_6_read_counts <- count_data[, pituitary_columns_6]

pituitary_columns_9 <- grep("pituitary_9", colnames(count_data))
pituitary_9_read_counts <- count_data[, pituitary_columns_9]

pituitary_columns_19 <- grep("pituitary_19", colnames(count_data))
pituitary_19_read_counts <- count_data[, pituitary_columns_19]
```


# Annotated tissue specific count data 
```{r}
pwbc_6_read_counts_annotated <- merge(pwbc_6_read_counts,
                                      annotation.ensembl.symbol,
                                      by.x="row.names",
                                      by.y="ensembl_gene_id",
                                      all.y=FALSE,
                                      all.x=FALSE)


pwbc_9_read_counts_annotated <- merge(pwbc_9_read_counts,
                                      annotation.ensembl.symbol,
                                      by.x="row.names",
                                      by.y="ensembl_gene_id",
                                      all.x=FALSE,
                                      all.y=FALSE)

pwbc_19_read_counts_annotated <- merge(pwbc_19_read_counts,
                                      annotation.ensembl.symbol,
                                      by.x="row.names",
                                      by.y="ensembl_gene_id",
                                      all.y=FALSE,
                                      all.x=FALSE)
                                      

endometrium_6_read_counts_annotated <- merge(endometrium_6_read_counts,
                                      annotation.ensembl.symbol,
                                      by.x="row.names",
                                      by.y="ensembl_gene_id",
                                      all.y=FALSE,
                                      all.x=FALSE)


endometrium_9_read_counts_annotated <- merge(endometrium_9_read_counts,
                                              annotation.ensembl.symbol,
                                              by.x="row.names",
                                              by.y="ensembl_gene_id",
                                              all.x=FALSE,
                                              all.y=FALSE)

endometrium_19_read_counts_annotated <- merge(endometrium_19_read_counts,
                                              annotation.ensembl.symbol,
                                              by.x="row.names",
                                              by.y="ensembl_gene_id",
                                              all.y=FALSE,
                                              all.x=FALSE)


hypothalamus_6_read_counts_annotated <- merge(hypothalamus_6_read_counts,
                                              annotation.ensembl.symbol,
                                              by.x="row.names",
                                              by.y="ensembl_gene_id",
                                              all.y=FALSE,
                                              all.x=FALSE)


hypothalamus_9_read_counts_annotated <- merge(hypothalamus_9_read_counts,
                                              annotation.ensembl.symbol,
                                              by.x="row.names",
                                              by.y="ensembl_gene_id",
                                              all.x=FALSE,
                                              all.y=FALSE)

hypothalamus_19_read_counts_annotated <- merge(hypothalamus_19_read_counts,
                                                annotation.ensembl.symbol,
                                                by.x="row.names",
                                                by.y="ensembl_gene_id",
                                                all.y=FALSE,
                                                all.x=FALSE)


pituitary_6_read_counts_annotated <- merge(pituitary_6_read_counts,
                                              annotation.ensembl.symbol,
                                              by.x="row.names",
                                              by.y="ensembl_gene_id",
                                              all.y=FALSE,
                                              all.x=FALSE)


pituitary_9_read_counts_annotated <- merge(pituitary_9_read_counts,
                                              annotation.ensembl.symbol,
                                              by.x="row.names",
                                              by.y="ensembl_gene_id",
                                              all.x=FALSE,
                                              all.y=FALSE)

pituitary_19_read_counts_annotated <- merge(pituitary_19_read_counts,
                                                annotation.ensembl.symbol,
                                                by.x="row.names",
                                                by.y="ensembl_gene_id",
                                                all.y=FALSE,
                                                all.x=FALSE)



pwbc_6_gene_length<-pwbc_6_read_counts_annotated$transcript_length
pwbc_9_gene_length<-pwbc_9_read_counts_annotated$transcript_length
pwbc_19_gene_length<-pwbc_19_read_counts_annotated$transcript_length


endometrium_6_gene_length<-endometrium_6_read_counts_annotated$transcript_length
endometrium_9_gene_length<-endometrium_9_read_counts_annotated$transcript_length
endometrium_19_gene_length<-endometrium_19_read_counts_annotated$transcript_length


hypothalamus_6_gene_length<-hypothalamus_6_read_counts_annotated$transcript_length
hypothalamus_9_gene_length<-hypothalamus_9_read_counts_annotated$transcript_length
hypothalamus_19_gene_length<-hypothalamus_19_read_counts_annotated$transcript_length


pituitary_6_gene_length<-pituitary_6_read_counts_annotated$transcript_length
pituitary_9_gene_length<-pituitary_9_read_counts_annotated$transcript_length
pituitary_19_gene_length<-pituitary_19_read_counts_annotated$transcript_length




```



```{r}
pwbc_6_count_data<-pwbc_6_read_counts_annotated[,c(2:12)]
rownames(pwbc_6_count_data)<-pwbc_6_read_counts_annotated$Row.names

pwbc_9_count_data<-pwbc_9_read_counts_annotated[,c(2:12)]
rownames(pwbc_9_count_data)<-pwbc_9_read_counts_annotated$Row.names

pwbc_19_count_data<-pwbc_19_read_counts_annotated[,c(2:12)]
rownames(pwbc_19_count_data)<-pwbc_19_read_counts_annotated$Row.names


endometrium_6_count_data<-endometrium_6_read_counts_annotated[,c(2:12)]
rownames(endometrium_6_count_data)<-endometrium_6_read_counts_annotated$Row.names

endometrium_9_count_data<-endometrium_9_read_counts_annotated[,c(2:12)]
rownames(endometrium_9_count_data)<-endometrium_9_read_counts_annotated$Row.names

endometrium_19_count_data<-endometrium_19_read_counts_annotated[,c(2:12)]
rownames(endometrium_19_count_data)<-endometrium_19_read_counts_annotated$Row.names


hypothalamus_6_count_data<-hypothalamus_6_read_counts_annotated[,c(2:12)]
rownames(hypothalamus_6_count_data)<-hypothalamus_6_read_counts_annotated$Row.names

hypothalamus_9_count_data<-hypothalamus_9_read_counts_annotated[,c(2:12)]
rownames(hypothalamus_9_count_data)<-hypothalamus_9_read_counts_annotated$Row.names

hypothalamus_19_count_data<-hypothalamus_19_read_counts_annotated[,c(2:12)]
rownames(hypothalamus_19_count_data)<-hypothalamus_19_read_counts_annotated$Row.names


pituitary_6_count_data<-pituitary_6_read_counts_annotated[,c(2:12)]
rownames(pituitary_6_count_data)<-pituitary_6_read_counts_annotated$Row.names

pituitary_9_count_data<-pituitary_9_read_counts_annotated[,c(2:12)]
rownames(pituitary_9_count_data)<-pituitary_9_read_counts_annotated$Row.names

pituitary_19_count_data<-pituitary_19_read_counts_annotated[,c(2:12)]
rownames(pituitary_19_count_data)<-pituitary_19_read_counts_annotated$Row.names

```



# Filter the count data 
```{r}
x <- pwbc_6_count_data / pwbc_6_gene_length
pwbc_6_tpm <- as.data.frame(t( t(x) * 1e6 / colSums(x) ))
pwbc_6_fpkm<-as.data.frame(edgeR::rpkm(pwbc_6_count_data, pwbc_6_gene_length))
pwbc_6_cpm<-as.data.frame(edgeR::cpm(pwbc_6_count_data))
pwbc_6_cpm_filtered<-pwbc_6_cpm[rowSums(pwbc_6_cpm>2) > 8,]
pwbc_6_tpm_filtered<-pwbc_6_fpkm[rowSums(pwbc_6_tpm>1) > 8,]

genes_expressed_pwbc<-intersect(rownames(pwbc_6_cpm_filtered), rownames(pwbc_6_tpm_filtered))
pwbc_6_tpm_filtered<-pwbc_6_tpm_filtered[rownames(pwbc_6_tpm_filtered) %in% genes_expressed_pwbc,]
pwbc_6_cpm_filtered<-pwbc_6_cpm_filtered[rownames(pwbc_6_cpm_filtered) %in% genes_expressed_pwbc,]
pwbc_6_count_filtered<-pwbc_6_count_data[rownames(pwbc_6_count_data) %in% genes_expressed_pwbc,]

pwbc_6_tpm_filtered<-pwbc_6_tpm_filtered[complete.cases(pwbc_6_tpm_filtered),]
pwbc_6_count_filtered<-pwbc_6_count_filtered[complete.cases(pwbc_6_count_filtered),]
```

```{r}
pwbc_6_count_filtered
```



```{r}
x <- pwbc_9_count_data / pwbc_9_gene_length
pwbc_9_tpm <- as.data.frame(t( t(x) * 1e6 / colSums(x) ))
pwbc_9_fpkm<-as.data.frame(edgeR::rpkm(pwbc_9_count_data, pwbc_9_gene_length))
pwbc_9_cpm<-as.data.frame(edgeR::cpm(pwbc_9_count_data))
pwbc_9_cpm_filtered<-pwbc_9_cpm[rowSums(pwbc_9_cpm>2) > 8,]
pwbc_9_tpm_filtered<-pwbc_9_fpkm[rowSums(pwbc_9_tpm>1) > 8,]

genes_expressed_pwbc<-intersect(rownames(pwbc_9_cpm_filtered), rownames(pwbc_9_tpm_filtered))
pwbc_9_tpm_filtered<-pwbc_9_tpm_filtered[rownames(pwbc_9_tpm_filtered) %in% genes_expressed_pwbc,]
pwbc_9_cpm_filtered<-pwbc_9_cpm_filtered[rownames(pwbc_9_cpm_filtered) %in% genes_expressed_pwbc,]
pwbc_9_count_filtered<-pwbc_9_count_data[rownames(pwbc_9_count_data) %in% genes_expressed_pwbc,]

pwbc_9_tpm_filtered<-pwbc_9_tpm_filtered[complete.cases(pwbc_9_tpm_filtered),]
pwbc_9_count_filtered<-pwbc_9_count_filtered[complete.cases(pwbc_9_count_filtered),]
```


```{r}
x <- pwbc_19_count_data / pwbc_19_gene_length
pwbc_19_tpm <- as.data.frame(t( t(x) * 1e6 / colSums(x) ))
pwbc_19_fpkm<-as.data.frame(edgeR::rpkm(pwbc_19_count_data, pwbc_19_gene_length))
pwbc_19_cpm<-as.data.frame(edgeR::cpm(pwbc_19_count_data))
pwbc_19_cpm_filtered<-pwbc_19_cpm[rowSums(pwbc_19_cpm>2) > 8,]
pwbc_19_tpm_filtered<-pwbc_19_fpkm[rowSums(pwbc_19_tpm>1) > 8,]

genes_expressed_pwbc<-intersect(rownames(pwbc_19_cpm_filtered), rownames(pwbc_19_tpm_filtered))
pwbc_19_tpm_filtered<-pwbc_19_tpm_filtered[rownames(pwbc_19_tpm_filtered) %in% genes_expressed_pwbc,]
pwbc_19_cpm_filtered<-pwbc_19_cpm_filtered[rownames(pwbc_19_cpm_filtered) %in% genes_expressed_pwbc,]
pwbc_19_count_filtered<-pwbc_19_count_data[rownames(pwbc_19_count_data) %in% genes_expressed_pwbc,]

pwbc_19_tpm_filtered<-pwbc_19_tpm_filtered[complete.cases(pwbc_19_tpm_filtered),]
pwbc_19_count_filtered<-pwbc_19_count_filtered[complete.cases(pwbc_19_count_filtered),]
```


```{r}
write.table(pwbc_6_count_filtered,
            "/home/yassine/Downloads/between_tissue/pwbc_6_count_filtered.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)


write.table(pwbc_9_count_filtered,
            "/home/yassine/Downloads/between_tissue/pwbc_9_count_filtered.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)


write.table(pwbc_19_count_filtered,
            "/home/yassine/Downloads/between_tissue/pwbc_19_count_filtered.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
```

```{r}
x <- endometrium_6_count_data / endometrium_6_gene_length
endometrium_6_tpm <- as.data.frame(t( t(x) * 1e6 / colSums(x) ))
endometrium_6_fpkm<-as.data.frame(edgeR::rpkm(endometrium_6_count_data, endometrium_6_gene_length))
endometrium_6_cpm<-as.data.frame(edgeR::cpm(endometrium_6_count_data))
endometrium_6_cpm_filtered<-endometrium_6_cpm[rowSums(endometrium_6_cpm>2) > 8,]
endometrium_6_tpm_filtered<-endometrium_6_fpkm[rowSums(endometrium_6_tpm>1) > 8,]

genes_expressed_endometrium<-intersect(rownames(endometrium_6_cpm_filtered), rownames(endometrium_6_tpm_filtered))
endometrium_6_tpm_filtered<-endometrium_6_tpm_filtered[rownames(endometrium_6_tpm_filtered) %in% genes_expressed_endometrium,]
endometrium_6_cpm_filtered<-endometrium_6_cpm_filtered[rownames(endometrium_6_cpm_filtered) %in% genes_expressed_endometrium,]
endometrium_6_count_filtered<-endometrium_6_count_data[rownames(endometrium_6_count_data) %in% genes_expressed_endometrium,]

endometrium_6_tpm_filtered<-endometrium_6_tpm_filtered[complete.cases(endometrium_6_tpm_filtered),]
endometrium_6_count_filtered<-endometrium_6_count_filtered[complete.cases(endometrium_6_count_filtered),]
```


```{r}
x <- endometrium_9_count_data / endometrium_9_gene_length
endometrium_9_tpm <- as.data.frame(t( t(x) * 1e6 / colSums(x) ))
endometrium_9_fpkm<-as.data.frame(edgeR::rpkm(endometrium_9_count_data, endometrium_9_gene_length))
endometrium_9_cpm<-as.data.frame(edgeR::cpm(endometrium_9_count_data))
endometrium_9_cpm_filtered<-endometrium_9_cpm[rowSums(endometrium_9_cpm>2) > 8,]
endometrium_9_tpm_filtered<-endometrium_9_fpkm[rowSums(endometrium_9_tpm>1) > 8,]

genes_expressed_endometrium<-intersect(rownames(endometrium_9_cpm_filtered), rownames(endometrium_9_tpm_filtered))
endometrium_9_tpm_filtered<-endometrium_9_tpm_filtered[rownames(endometrium_9_tpm_filtered) %in% genes_expressed_endometrium,]
endometrium_9_cpm_filtered<-endometrium_9_cpm_filtered[rownames(endometrium_9_cpm_filtered) %in% genes_expressed_endometrium,]
endometrium_9_count_filtered<-endometrium_9_count_data[rownames(endometrium_9_count_data) %in% genes_expressed_endometrium,]

endometrium_9_tpm_filtered<-endometrium_9_tpm_filtered[complete.cases(endometrium_9_tpm_filtered),]
endometrium_9_count_filtered<-endometrium_9_count_filtered[complete.cases(endometrium_9_count_filtered),]
```


```{r}
x <- endometrium_19_count_data / endometrium_19_gene_length
endometrium_19_tpm <- as.data.frame(t( t(x) * 1e6 / colSums(x) ))
endometrium_19_fpkm<-as.data.frame(edgeR::rpkm(endometrium_19_count_data, endometrium_19_gene_length))
endometrium_19_cpm<-as.data.frame(edgeR::cpm(endometrium_19_count_data))
endometrium_19_cpm_filtered<-endometrium_19_cpm[rowSums(endometrium_19_cpm>2) > 8,]
endometrium_19_tpm_filtered<-endometrium_19_fpkm[rowSums(endometrium_19_tpm>1) > 8,]

genes_expressed_endometrium<-intersect(rownames(endometrium_19_cpm_filtered), rownames(endometrium_19_tpm_filtered))
endometrium_19_tpm_filtered<-endometrium_19_tpm_filtered[rownames(endometrium_19_tpm_filtered) %in% genes_expressed_endometrium,]
endometrium_19_cpm_filtered<-endometrium_19_cpm_filtered[rownames(endometrium_19_cpm_filtered) %in% genes_expressed_endometrium,]
endometrium_19_count_filtered<-endometrium_19_count_data[rownames(endometrium_19_count_data) %in% genes_expressed_endometrium,]

endometrium_19_tpm_filtered<-endometrium_19_tpm_filtered[complete.cases(endometrium_19_tpm_filtered),]
endometrium_19_count_filtered<-endometrium_19_count_filtered[complete.cases(endometrium_19_count_filtered),]
```


```{r}
write.table(endometrium_6_count_filtered,
            "/home/yassine/Downloads/between_tissue/endometrium_6_count_filtered.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)


write.table(endometrium_9_count_filtered,
            "/home/yassine/Downloads/between_tissue/endometrium_9_count_filtered.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)


write.table(endometrium_19_count_filtered,
            "/home/yassine/Downloads/between_tissue/endometrium_19_count_filtered.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
```

```{r}
x <- pituitary_6_count_data / pituitary_6_gene_length
pituitary_6_tpm <- as.data.frame(t( t(x) * 1e6 / colSums(x) ))
pituitary_6_fpkm<-as.data.frame(edgeR::rpkm(pituitary_6_count_data, pituitary_6_gene_length))
pituitary_6_cpm<-as.data.frame(edgeR::cpm(pituitary_6_count_data))
pituitary_6_cpm_filtered<-pituitary_6_cpm[rowSums(pituitary_6_cpm>2) > 8,]
pituitary_6_tpm_filtered<-pituitary_6_fpkm[rowSums(pituitary_6_tpm>1) > 8,]

genes_expressed_pituitary<-intersect(rownames(pituitary_6_cpm_filtered), rownames(pituitary_6_tpm_filtered))
pituitary_6_tpm_filtered<-pituitary_6_tpm_filtered[rownames(pituitary_6_tpm_filtered) %in% genes_expressed_pituitary,]
pituitary_6_cpm_filtered<-pituitary_6_cpm_filtered[rownames(pituitary_6_cpm_filtered) %in% genes_expressed_pituitary,]
pituitary_6_count_filtered<-pituitary_6_count_data[rownames(pituitary_6_count_data) %in% genes_expressed_pituitary,]

pituitary_6_tpm_filtered<-pituitary_6_tpm_filtered[complete.cases(pituitary_6_tpm_filtered),]
pituitary_6_count_filtered<-pituitary_6_count_filtered[complete.cases(pituitary_6_count_filtered),]
```


```{r}
x <- pituitary_9_count_data / pituitary_9_gene_length
pituitary_9_tpm <- as.data.frame(t( t(x) * 1e6 / colSums(x) ))
pituitary_9_fpkm<-as.data.frame(edgeR::rpkm(pituitary_9_count_data, pituitary_9_gene_length))
pituitary_9_cpm<-as.data.frame(edgeR::cpm(pituitary_9_count_data))
pituitary_9_cpm_filtered<-pituitary_9_cpm[rowSums(pituitary_9_cpm>2) > 8,]
pituitary_9_tpm_filtered<-pituitary_9_fpkm[rowSums(pituitary_9_tpm>1) > 8,]

genes_expressed_pituitary<-intersect(rownames(pituitary_9_cpm_filtered), rownames(pituitary_9_tpm_filtered))
pituitary_9_tpm_filtered<-pituitary_9_tpm_filtered[rownames(pituitary_9_tpm_filtered) %in% genes_expressed_pituitary,]
pituitary_9_cpm_filtered<-pituitary_9_cpm_filtered[rownames(pituitary_9_cpm_filtered) %in% genes_expressed_pituitary,]
pituitary_9_count_filtered<-pituitary_9_count_data[rownames(pituitary_9_count_data) %in% genes_expressed_pituitary,]

pituitary_9_tpm_filtered<-pituitary_9_tpm_filtered[complete.cases(pituitary_9_tpm_filtered),]
pituitary_9_count_filtered<-pituitary_9_count_filtered[complete.cases(pituitary_9_count_filtered),]
```


```{r}
x <- pituitary_19_count_data / pituitary_19_gene_length
pituitary_19_tpm <- as.data.frame(t( t(x) * 1e6 / colSums(x) ))
pituitary_19_fpkm<-as.data.frame(edgeR::rpkm(pituitary_19_count_data, pituitary_19_gene_length))
pituitary_19_cpm<-as.data.frame(edgeR::cpm(pituitary_19_count_data))
pituitary_19_cpm_filtered<-pituitary_19_cpm[rowSums(pituitary_19_cpm>2) > 8,]
pituitary_19_tpm_filtered<-pituitary_19_fpkm[rowSums(pituitary_19_tpm>1) > 8,]

genes_expressed_pituitary<-intersect(rownames(pituitary_19_cpm_filtered), rownames(pituitary_19_tpm_filtered))
pituitary_19_tpm_filtered<-pituitary_19_tpm_filtered[rownames(pituitary_19_tpm_filtered) %in% genes_expressed_pituitary,]
pituitary_19_cpm_filtered<-pituitary_19_cpm_filtered[rownames(pituitary_19_cpm_filtered) %in% genes_expressed_pituitary,]
pituitary_19_count_filtered<-pituitary_19_count_data[rownames(pituitary_19_count_data) %in% genes_expressed_pituitary,]

pituitary_19_tpm_filtered<-pituitary_19_tpm_filtered[complete.cases(pituitary_19_tpm_filtered),]
pituitary_19_count_filtered<-pituitary_19_count_filtered[complete.cases(pituitary_19_count_filtered),]
```


```{r}
write.table(pituitary_6_count_filtered,
            "/home/yassine/Downloads/between_tissue/pituitary_6_count_filtered.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)


write.table(pituitary_9_count_filtered,
            "/home/yassine/Downloads/between_tissue/pituitary_9_count_filtered.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)


write.table(pituitary_19_count_filtered,
            "/home/yassine/Downloads/between_tissue/pituitary_19_count_filtered.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
```



```{r}
x <- hypothalamus_6_count_data / hypothalamus_6_gene_length
hypothalamus_6_tpm <- as.data.frame(t( t(x) * 1e6 / colSums(x) ))
hypothalamus_6_fpkm<-as.data.frame(edgeR::rpkm(hypothalamus_6_count_data, hypothalamus_6_gene_length))
hypothalamus_6_cpm<-as.data.frame(edgeR::cpm(hypothalamus_6_count_data))
hypothalamus_6_cpm_filtered<-hypothalamus_6_cpm[rowSums(hypothalamus_6_cpm>2) > 8,]
hypothalamus_6_tpm_filtered<-hypothalamus_6_fpkm[rowSums(hypothalamus_6_tpm>1) > 8,]

genes_expressed_hypothalamus<-intersect(rownames(hypothalamus_6_cpm_filtered), rownames(hypothalamus_6_tpm_filtered))
hypothalamus_6_tpm_filtered<-hypothalamus_6_tpm_filtered[rownames(hypothalamus_6_tpm_filtered) %in% genes_expressed_hypothalamus,]
hypothalamus_6_cpm_filtered<-hypothalamus_6_cpm_filtered[rownames(hypothalamus_6_cpm_filtered) %in% genes_expressed_hypothalamus,]
hypothalamus_6_count_filtered<-hypothalamus_6_count_data[rownames(hypothalamus_6_count_data) %in% genes_expressed_hypothalamus,]

hypothalamus_6_tpm_filtered<-hypothalamus_6_tpm_filtered[complete.cases(hypothalamus_6_tpm_filtered),]
hypothalamus_6_count_filtered<-hypothalamus_6_count_filtered[complete.cases(hypothalamus_6_count_filtered),]


x <- hypothalamus_9_count_data / hypothalamus_9_gene_length
hypothalamus_9_tpm <- as.data.frame(t( t(x) * 1e6 / colSums(x) ))
hypothalamus_9_fpkm<-as.data.frame(edgeR::rpkm(hypothalamus_9_count_data, hypothalamus_9_gene_length))
hypothalamus_9_cpm<-as.data.frame(edgeR::cpm(hypothalamus_9_count_data))
hypothalamus_9_cpm_filtered<-hypothalamus_9_cpm[rowSums(hypothalamus_9_cpm>2) > 8,]
hypothalamus_9_tpm_filtered<-hypothalamus_9_fpkm[rowSums(hypothalamus_9_tpm>1) > 8,]

genes_expressed_hypothalamus<-intersect(rownames(hypothalamus_9_cpm_filtered), rownames(hypothalamus_9_tpm_filtered))
hypothalamus_9_tpm_filtered<-hypothalamus_9_tpm_filtered[rownames(hypothalamus_9_tpm_filtered) %in% genes_expressed_hypothalamus,]
hypothalamus_9_cpm_filtered<-hypothalamus_9_cpm_filtered[rownames(hypothalamus_9_cpm_filtered) %in% genes_expressed_hypothalamus,]
hypothalamus_9_count_filtered<-hypothalamus_9_count_data[rownames(hypothalamus_9_count_data) %in% genes_expressed_hypothalamus,]

hypothalamus_9_tpm_filtered<-hypothalamus_9_tpm_filtered[complete.cases(hypothalamus_9_tpm_filtered),]
hypothalamus_9_count_filtered<-hypothalamus_9_count_filtered[complete.cases(hypothalamus_9_count_filtered),]


x <- hypothalamus_19_count_data / hypothalamus_19_gene_length
hypothalamus_19_tpm <- as.data.frame(t( t(x) * 1e6 / colSums(x) ))
hypothalamus_19_fpkm<-as.data.frame(edgeR::rpkm(hypothalamus_19_count_data, hypothalamus_19_gene_length))
hypothalamus_19_cpm<-as.data.frame(edgeR::cpm(hypothalamus_19_count_data))
hypothalamus_19_cpm_filtered<-hypothalamus_19_cpm[rowSums(hypothalamus_19_cpm>2) > 8,]
hypothalamus_19_tpm_filtered<-hypothalamus_19_fpkm[rowSums(hypothalamus_19_tpm>1) > 8,]

genes_expressed_hypothalamus<-intersect(rownames(hypothalamus_19_cpm_filtered), rownames(hypothalamus_19_tpm_filtered))
hypothalamus_19_tpm_filtered<-hypothalamus_19_tpm_filtered[rownames(hypothalamus_19_tpm_filtered) %in% genes_expressed_hypothalamus,]
hypothalamus_19_cpm_filtered<-hypothalamus_19_cpm_filtered[rownames(hypothalamus_19_cpm_filtered) %in% genes_expressed_hypothalamus,]
hypothalamus_19_count_filtered<-hypothalamus_19_count_data[rownames(hypothalamus_19_count_data) %in% genes_expressed_hypothalamus,]

hypothalamus_19_tpm_filtered<-hypothalamus_19_tpm_filtered[complete.cases(hypothalamus_19_tpm_filtered),]
hypothalamus_19_count_filtered<-hypothalamus_19_count_filtered[complete.cases(hypothalamus_19_count_filtered),]
```



```{r}
write.table(hypothalamus_6_count_filtered,
            "/home/yassine/Downloads/between_tissue/hypothalamus_6_count_filtered.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)


write.table(hypothalamus_9_count_filtered,
            "/home/yassine/Downloads/between_tissue/hypothalamus_9_count_filtered.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)


write.table(hypothalamus_19_count_filtered,
            "/home/yassine/Downloads/between_tissue/hypothalamus_19_count_filtered.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
```

# Venn diagramd to see the overlapping genes between the filterred tissue specific read counts 
```{r}
gene_numbers_venn_diagram_6_months <-venn.diagram(list("pituitary"=rownames(pwbc_6_count_filtered),
                                                       "endometrium"=rownames(endometrium_6_count_filtered),
                                                       "hypothalamus"=rownames(hypothalamus_6_count_filtered),
                                                       "pituitary"=rownames(pituitary_6_count_filtered)),
                                                    cex=1,
                                                    scaled= FALSE, 
                                                    filename = NULL,
                                                    output=TRUE,
                                                    col="transparent",
                                                    fill=c("green", "red","blue","yellow"))

gene_numbers_venn_diagram_9_months <-venn.diagram(list("pituitary"=rownames(pwbc_9_count_filtered),
                                                       "endometrium"=rownames(endometrium_9_count_filtered),
                                                       "hypothalamus"=rownames(hypothalamus_9_count_filtered),
                                                       "pituitary"=rownames(pituitary_9_count_filtered)),
                                                  cex=1,
                                                  scaled= FALSE, 
                                                  filename = NULL,
                                                  output=TRUE,
                                                  col="transparent",
                                                  fill=c("green", "red","blue","yellow"))

gene_numbers_venn_diagram_19_months <-venn.diagram(list("pituitary"=rownames(pwbc_19_count_filtered),
                                                         "endometrium"=rownames(endometrium_19_count_filtered),
                                                         "hypothalamus"=rownames(hypothalamus_19_count_filtered),
                                                         "pituitary"=rownames(pituitary_19_count_filtered)),
                                                    cex=1,
                                                    scaled= FALSE, 
                                                    filename = NULL,
                                                    output=TRUE,
                                                    col="transparent",
                                                    fill=c("green", "red","blue","yellow"))
```

```{r}
ggsave(filename="/home/yassine/Downloads/between_tissue/Figures/gene_numbers_venn_diagram_6_months.png",
       plot = gene_numbers_venn_diagram_6_months, 
       width = 10, 
       height = 10)

ggsave(filename="/home/yassine/Downloads/between_tissue/Figures/gene_numbers_venn_diagram_9_months.png",
       plot = gene_numbers_venn_diagram_9_months, 
       width = 10, 
       height = 10)

ggsave(filename="/home/yassine/Downloads/between_tissue/Figures/gene_numbers_venn_diagram_19_months.png",
       plot = gene_numbers_venn_diagram_19_months, 
       width = 10, 
       height = 10)
```


```{r}
# CTF and asinh transform the filtered  read count data
lib_size <- base::colSums(pwbc_6_count_filtered)
norm_factors <- calcNormFactors(object = pwbc_6_count_filtered,
                                lib.size = lib_size,
                                method = "TMM")
CTF_normalized_pwbc_6 <- sweep(pwbc_6_count_filtered,2,norm_factors,"/")
asinh_transf_CTF_normalized_pwbc_6<-asinh(CTF_normalized_pwbc_6)

lib_size <- base::colSums(pwbc_9_count_filtered)
norm_factors <- calcNormFactors(object = pwbc_9_count_filtered,
                                lib.size = lib_size,
                                method = "TMM")
CTF_normalized_pwbc_9 <- sweep(pwbc_9_count_filtered,2,norm_factors,"/")
asinh_transf_CTF_normalized_pwbc_9<-asinh(CTF_normalized_pwbc_9)

lib_size <- base::colSums(pwbc_19_count_filtered)
norm_factors <- calcNormFactors(object = pwbc_19_count_filtered,
                                lib.size = lib_size,
                                method = "TMM")
CTF_normalized_pwbc_19 <- sweep(pwbc_19_count_filtered,2,norm_factors,"/")
asinh_transf_CTF_normalized_pwbc_19<-asinh(CTF_normalized_pwbc_19)
```


```{r}
lib_size <- base::colSums(endometrium_6_count_filtered)
norm_factors <- calcNormFactors(object = endometrium_6_count_filtered,
                                lib.size = lib_size,
                                method = "TMM")

CTF_normalized_endometrium_6 <- sweep(endometrium_6_count_filtered,2,norm_factors,"/")
asinh_transf_CTF_normalized_endometrium_6<-asinh(CTF_normalized_endometrium_6)

lib_size <- base::colSums(endometrium_9_count_filtered)
norm_factors <- calcNormFactors(object = endometrium_9_count_filtered,
                                lib.size = lib_size,
                                method = "TMM")

CTF_normalized_endometrium_9 <- sweep(endometrium_9_count_filtered,2,norm_factors,"/")
asinh_transf_CTF_normalized_endometrium_9<-asinh(CTF_normalized_endometrium_9)


lib_size <- base::colSums(endometrium_19_count_filtered)
norm_factors <- calcNormFactors(object = endometrium_19_count_filtered,
                                lib.size = lib_size,
                                method = "TMM")

CTF_normalized_endometrium_19 <- sweep(endometrium_19_count_filtered,2,norm_factors,"/")
asinh_transf_CTF_normalized_endometrium_19<-asinh(CTF_normalized_endometrium_19)
```


```{r}
lib_size <- base::colSums(hypothalamus_6_count_filtered)
norm_factors <- calcNormFactors(object = hypothalamus_6_count_filtered,
                                lib.size = lib_size,
                                method = "TMM")

CTF_normalized_hypothalamus_6 <- sweep(hypothalamus_6_count_filtered,2,norm_factors,"/")
asinh_transf_CTF_normalized_hypothalamus_6<-asinh(CTF_normalized_hypothalamus_6)

lib_size <- base::colSums(hypothalamus_9_count_filtered)
norm_factors <- calcNormFactors(object = hypothalamus_9_count_filtered,
                                lib.size = lib_size,
                                method = "TMM")

CTF_normalized_hypothalamus_9 <- sweep(hypothalamus_9_count_filtered,2,norm_factors,"/")
asinh_transf_CTF_normalized_hypothalamus_9<-asinh(CTF_normalized_hypothalamus_9)

lib_size <- base::colSums(hypothalamus_19_count_filtered)
norm_factors <- calcNormFactors(object = hypothalamus_19_count_filtered,
                                lib.size = lib_size,
                                method = "TMM")

CTF_normalized_hypothalamus_19 <- sweep(hypothalamus_19_count_filtered,2,norm_factors,"/")
asinh_transf_CTF_normalized_hypothalamus_19<-asinh(CTF_normalized_hypothalamus_19)
```


```{r}
lib_size <- base::colSums(pituitary_6_count_filtered)
norm_factors <- calcNormFactors(object = pituitary_6_count_filtered,
                                lib.size = lib_size,
                                method = "TMM")
CTF_normalized_pituitary_6 <- sweep(pituitary_6_count_filtered,2,norm_factors,"/")
asinh_transf_CTF_normalized_pituitary_6 <-asinh(CTF_normalized_pituitary_6)

lib_size <- base::colSums(pituitary_9_count_filtered)
norm_factors <- calcNormFactors(object = pituitary_9_count_filtered,
                                lib.size = lib_size,
                                method = "TMM")
CTF_normalized_pituitary_9 <- sweep(pituitary_9_count_filtered,2,norm_factors,"/")
asinh_transf_CTF_normalized_pituitary_9 <-asinh(CTF_normalized_pituitary_9)

lib_size <- base::colSums(pituitary_19_count_filtered)
norm_factors <- calcNormFactors(object = pituitary_19_count_filtered,
                                lib.size = lib_size,
                                method = "TMM")
CTF_normalized_pituitary_19 <- sweep(pituitary_19_count_filtered,2,norm_factors,"/")
asinh_transf_CTF_normalized_pituitary_19 <-asinh(CTF_normalized_pituitary_19)
```

```{r}
write.table(asinh_transf_CTF_normalized_pwbc_6,
            "/home/yassine/Downloads/between_tissue/asinh_transf_CTF_normalized_pwbc_6.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)

write.table(asinh_transf_CTF_normalized_pwbc_9,
            "/home/yassine/Downloads/between_tissue/asinh_transf_CTF_normalized_pwbc_9.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)

write.table(asinh_transf_CTF_normalized_pwbc_19,
            "/home/yassine/Downloads/between_tissue/asinh_transf_CTF_normalized_pwbc_19.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
```


```{r}
write.table(asinh_transf_CTF_normalized_endometrium_6,
            "/home/yassine/Downloads/between_tissue/asinh_transf_CTF_normalized_endometrium_6.txt",
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)

write.table(asinh_transf_CTF_normalized_endometrium_9,
            "/home/yassine/Downloads/between_tissue/asinh_transf_CTF_normalized_endometrium_9.txt",
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
write.table(asinh_transf_CTF_normalized_endometrium_19,
            "/home/yassine/Downloads/between_tissue/asinh_transf_CTF_normalized_endometrium_19.txt",
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
```


```{r}
write.table(asinh_transf_CTF_normalized_hypothalamus_6,
            "/home/yassine/Downloads/between_tissue/asinh_transf_CTF_normalized_hypothalamus_6.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
write.table(asinh_transf_CTF_normalized_hypothalamus_9,
            "/home/yassine/Downloads/between_tissue/asinh_transf_CTF_normalized_hypothalamus_9.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
write.table(asinh_transf_CTF_normalized_hypothalamus_19,
            "/home/yassine/Downloads/between_tissue/asinh_transf_CTF_normalized_hypothalamus_19.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
```

```{r}
write.table(asinh_transf_CTF_normalized_pituitary_6,
            "/home/yassine/Downloads/between_tissue/asinh_transf_CTF_normalized_pituitary_6.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
write.table(asinh_transf_CTF_normalized_pituitary_9,
            "/home/yassine/Downloads/between_tissue/asinh_transf_CTF_normalized_pituitary_9.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
write.table(asinh_transf_CTF_normalized_pituitary_19,
            "/home/yassine/Downloads/between_tissue/asinh_transf_CTF_normalized_pituitary_19.txt",
            quote = TRUE,
            sep = "\t",
            row.names = TRUE,
            col.names = TRUE)
```
